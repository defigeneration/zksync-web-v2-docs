# Блоки

Блок - это упорядоченный список транзакций. Каждый блок (за исключением Генезис-блока) указывает на предыдущий блок(для которого текущий служит расширением), и таким образом создается цепочка блоков - блокчейн.

### Блоки в zkSync 2.0 <a href="#blocks-in-zksync-2-0" id="blocks-in-zksync-2-0"></a>

В zkSync 2.0 есть два определения "блоков": блок L2 и роллап-блок L1.

L2 блоки, или просто "блоки", это обычные блоки, создаваемые на L2, т.е. в сети zkSync. Они не включаются в сеть Эфириум. Роллап-блок L1, который мы называем "пачкой", это набор последовательных (L2) блоков. Он включает в себя все транзакции, и в том же порядке, с первого и до последнего блока в пачке.

L1 пачки, на что и указывает название, отправляются в Ethereum. Основная причина, почему у нас есть такие различия в определенияъ - это то, что блок может содержать минимальное количество транзакций, и, таким образом, обрабатываться быстро, в то время как в пачку мы бы хотели вместить множество транзакций, чтобы сделать плату за взаимодействие с L1 распределенной на много транзакций (дешевле).

### Номера блоков <a href="#block-numbers" id="block-numbers"></a>

Получение доступа к номера блоков в рамках zkSync API схоже с аналогичным на Ethereum. Например, `eth_blockNumber` возвращает номер последнего блока L2, а `eth_getBlockByNumber`, получив номер блока, возвращает информацию о запрошенном блоке.

Для пачек L1, чтобы получить номер последней пачки, используйте метод `zks_L1BatchNumber` в zkSync API. Кроме того, делая запрос по блоку, вы можете увидеть номер пачки, которая включает в себя данный блок. Внутри чека транзакции поле `l1BatchNumber` - это номер пачки, которая включает данную транзакцию. Поле `l1BatchTxIndex` возвращает порядковую позицию транзакции среди всех транзакций в пачке.

### Время обработки блока <a href="#block-processing-time" id="block-processing-time"></a>

Транзакции проводятся оператором моментально и добавляются в  блоки, которые в свою очередь моментально генерируются. Как только zkSync станет полностью децентрализованным, время блока будет составлять всего пару секунд, так как вовлеченным лицам нужно достичь консенсуса.

Время для пачки обычно зависит от активности в системе: чем больше активности, тем быстрее _запечатывается_ пачка. Есть несколько критериев для запечатывания пачки, которые вы не будем обсуждать здесь в деталях, т.к. система пока находится в тестовом режиме и переменные могут меняться. Как правило, пачка запечатывается, когда:

1. "Возможности" пачки достигли максимума. "Возможности" включают в себя количество использовуемого газа на L1, количество использованных ergs на L2 и еще несколько параметров.
2. Время ожидания пачки истекло.

После отправки транзакции пользователь может проверить, на какой стадии находится его транзакция, как описано [здесь](https://v2-docs.zksync.io/dev/fundamentals/zkSync.html#zksync-overview).

#### Пустые блоки

{% hint style="warning" %}
**ПРЕДУПРЕЖДЕНИЕ**

В настоящее время пустые блоки отображаются в нашем обозревателе блоков. Пожалуйста, имейте в виду, что это не ошибка, и происходит согласно задумке.

Хотя это может быть и временным решением, важно учитывать рационализм, стоящий за ним.
{% endhint %}

Каждая пачка L1 (которая состоит из нескольких L2-блоков) исполняется в одной инстанции виртуальной машины (VM). Виртуальная машина исполняет транзакции одну за другой и в конце исполняет некоторый код, который закрывает не последнюю транзацию, а всю пачку целиком. На данный момент ETH, собираемый в качестве комиссий, отправляется с формального адреса bootloader'a на адрес майнера блоков (блок-майнер). Дело в том, что такой перевод создает событие (как и любой другой перевод), следовательно, мы включаем это событие в L2-блок, чтобы оно было доступно через API.

Мы могли бы добавлять его в последний L2-блок из L1-пачки, но представьте себе следующий сценарий: если L2 блок закрылся, но его L1 пачка нет, а узел (нода) давно не получала каких-либо транзакций, тогда L1 пачка должна быть закрыта по таймауту (истечению времени ожидания). Если мы добавим событие к последнему закрытому блоку, то это модифицирует блок, что приведет к некой реорганизации. Именно для избежания этого мы внедрили чисто "вымышленный" блок, включающий в себя одно единственное событие.

#### Хэши <a href="#hashes" id="hashes"></a>

Хэши блоков в zkSync являются детерминистическими и извлекаются из следующей формулы: "keccak256(l2\_block\_number)". Причиной, почему хэши блоков являются детерминистическими, является то, что эти хеши не доказуемы (помним, что L2 блоки не отправляются на L1). Проектам рекомендуется не использовать хэш блоков L2 как источник случайности/рандома.

#### Параметры блока <a href="#block-properties" id="block-properties"></a>

* Timestamp: Время создания текущего блока в секундах, которое возвращает временную метку пачки L1.
* Block number: Уникальный порядковый номер для данного блока.
* Gas limit: Лимит газа текущего блока, всегда возвращает `2^32-1`.
* Coinbase: Адрес майнера текущего блока, возвращает адрес [bootloader](https://v2-docs.zksync.io/dev/developer-guides/contracts/system-contracts.html#bootloader)'a.
* Difficulty: Сложность текущего блока, возвращает `2500000000000000` (у zkSync нет алгоритма консенсуса proof-of-work).

